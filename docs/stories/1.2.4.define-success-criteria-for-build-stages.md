# Story 1.2.4: Define Success Criteria for All Build Stages

## Status
Draft

## Story
**As a** Phase 0 developer,
**I want** success criteria from build stage definitions integrated into session configuration,
**so that** dev-agent has automated validation gates to detect when stages complete successfully during Phase 1 autonomous execution.

## Acceptance Criteria

1. Session configuration (Story 2.3) `success_criteria` section maps all 6 stage exit criteria from Story 2.2
2. Each stage criterion expressed as: validation command (e.g., `npm test`, `npm run build`, `git status`), expected output/exit code, failure handling instruction (retry, checkpoint, abort)
3. Stage 1 (Project Setup) success criteria include: Monorepo npm workspaces configured, packages/shared types created, lib/placeholders.ts implemented with 8 categories, next.config.js + tailwind.config.js + middleware.ts created, TypeScript compiles without errors
4. Stage 2 (Frontend Foundation) success criteria include: App Router structure created ([slug] + [location]/[slug] routes), Root layout with GTM implemented, globals.css with Tailwind configured, Next.js builds successfully, placeholder images loading correctly
5. Stage 3 (Multi-Step Form) success criteria include: MultiStepForm orchestrator component created, Step1BasicInfo + Step2ProjectDetails + Step3TCPAConsent components functional, FormContext + MarketingContext providers working, Zod validation schemas (step1-schema, step2-schema, step3-schema) in packages/shared, reCAPTCHA v3 integrated, form submission flow tested
6. Stage 4 (Airtable Integration) success criteria include: Netlify Functions deployed (submit-form, validate-recaptcha, webhook-make-com routes), AirtableService with CRUD operations functional, RecaptchaService with score validation working, DuplicateDetectionService (5-min window) tested, form submissions successfully writing to Airtable
7. Stage 5 (Make.com Automation) success criteria include: Make.com Scenario 1 (content generation) configured and tested, Make.com Scenario 2 (deployment trigger) configured and tested, Claude API integration functional (content + PMax assets), Netlify build hook triggering successfully
8. Stage 6 (Deployment & Testing) success criteria include: Netlify production deployment successful, DNS/domain configured, Playwright E2E tests pass (form submission, validation, thank-you page), Core Web Vitals validated (LCP <2.5s, INP <200ms, CLS <0.1), Lighthouse score ≥90

## Tasks / Subtasks

- [ ] Review build stage definitions (Prerequisites)
  - [ ] Read `docs/phase-1-build-stages.md` (Story 2.2)
  - [ ] Extract exit criteria for all 6 stages
  - [ ] Identify validation commands for each criterion
- [ ] Open session configuration for editing (AC: 1)
  - [ ] Open `Landing Pages Automation/claude-session-config.yaml`
  - [ ] Create `success_criteria` section structure
  - [ ] Prepare to add criteria for each stage
- [ ] Define validation command format (AC: 2)
  - [ ] Document command structure (command, expected output, exit code)
  - [ ] Define failure handling options: retry, checkpoint, abort
  - [ ] Create template for criterion entries
- [ ] Add Stage 1 success criteria (AC: 3)
  - [ ] Monorepo npm workspaces: `npm run build` succeeds
  - [ ] packages/shared types: TypeScript compiles
  - [ ] lib/placeholders.ts: File exists with 8 categories
  - [ ] Config files: next.config.js, tailwind.config.js, middleware.ts exist
  - [ ] TypeScript compilation: `tsc --noEmit` exits 0
- [ ] Add Stage 2 success criteria (AC: 4)
  - [ ] App Router structure: Routes accessible via navigation
  - [ ] GTM integration: GTM fires on page load
  - [ ] Tailwind configured: Styles apply correctly
  - [ ] Next.js builds: `next build` succeeds
  - [ ] Placeholder images: Images load without 404 errors
- [ ] Add Stage 3 success criteria (AC: 5)
  - [ ] MultiStepForm orchestrator: Component renders
  - [ ] Step components: All 3 steps render and advance
  - [ ] Context providers: FormContext + MarketingContext functional
  - [ ] Zod schemas: Validation blocks invalid input
  - [ ] reCAPTCHA v3: Score validation working
  - [ ] Form submission: End-to-end flow completes
- [ ] Add Stage 4 success criteria (AC: 6)
  - [ ] Netlify Functions: All 3 routes deployed and accessible
  - [ ] AirtableService: CRUD operations tested
  - [ ] RecaptchaService: Score validation tested
  - [ ] DuplicateDetectionService: 5-min window tested
  - [ ] Form to Airtable: Submissions write successfully
- [ ] Add Stage 5 success criteria (AC: 7)
  - [ ] Make.com Scenario 1: Content generation tested
  - [ ] Make.com Scenario 2: Deployment trigger tested
  - [ ] Claude API: Content + PMax assets generated
  - [ ] Netlify build hook: Deployment triggered successfully
- [ ] Add Stage 6 success criteria (AC: 8)
  - [ ] Netlify deployment: Production site accessible
  - [ ] DNS configuration: Domain resolves correctly
  - [ ] Playwright E2E: All tests pass
  - [ ] Core Web Vitals: LCP <2.5s, INP <200ms, CLS <0.1
  - [ ] Lighthouse score: ≥90
- [ ] Define failure handling per criterion (AC: 2)
  - [ ] Specify retry logic for transient failures
  - [ ] Specify checkpoint for recoverable failures
  - [ ] Specify abort for critical failures
- [ ] Commit updated session config to Git
  - [ ] Review success criteria completeness
  - [ ] Verify all 6 stages covered
  - [ ] Stage file with `git add`
  - [ ] Create commit with message: `feat: add success criteria validation gates to session config`
  - [ ] Verify commit was created successfully

## Dev Notes

### Context
Fourth story in Phase 0 Epic 2. Extends session configuration from Story 2.3 with detailed success criteria for all 6 build stages. These criteria enable dev-agent to validate autonomous progress and detect stage completion.

### Key Information
- **Config Location:** `Landing Pages Automation/claude-session-config.yaml` (update from Story 2.3)
- **Source:** Exit criteria from `docs/phase-1-build-stages.md` (Story 2.2)
- **Format:** Validation commands with expected outcomes and failure handling

### Dependencies
- **Prerequisites:** Stories 2.2 (build stages), 2.3 (session config)
- **Blocks:** Story 2.5 (validation of configuration)
- **Informs:** Dev-agent autonomous validation during Phase 1

### Success Criteria Structure
Each criterion includes:
1. **Validation Command:** Executable command (npm, git, curl, etc.)
2. **Expected Output:** Exit code or output pattern
3. **Failure Handling:** retry (transient), checkpoint (recoverable), abort (critical)

### Validation Command Examples
- `npm run build`: Exit code 0 (success)
- `npm test`: Exit code 0, all tests pass
- `tsc --noEmit`: Exit code 0, no type errors
- `git status`: Clean working directory
- `curl [url]`: HTTP 200 response

### Stage Dependencies
- Stage N cannot start until Stage N-1 success criteria met
- Dev-agent checks criteria automatically at stage transitions
- Failed criteria trigger failure handling (retry/checkpoint/abort)

### Important Decisions
- Success criteria are automatable (no manual verification)
- Validation commands are deterministic (consistent results)
- Failure handling preserves state for recovery
- All criteria map directly to exit criteria from Story 2.2
- Configuration remains testable and version-controlled

### Testing

**Test Standards:**
- No automated tests required (configuration extension)
- Manual validation command verification
- Completeness check against Stage 2.2 exit criteria

**Validation Requirements:**
- All 6 stages have success criteria defined
- Each criterion has validation command
- Expected outputs specified
- Failure handling defined for each criterion
- All criteria map to Story 2.2 exit criteria
- Configuration remains valid YAML
- Document committed to Git

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | 1.0 | Initial story creation from Epic 2 requirements | PM Agent (John) |

## Dev Agent Record

_(This section is owned by dev-agent and can only be modified by dev-agent)_

### Agent Model Used
_(This section will be populated by dev-agent during implementation)_

### Debug Log References
_(This section will be populated by dev-agent during implementation)_

### Completion Notes
_(This section will be populated by dev-agent during implementation)_

### File List
_(This section will be populated by dev-agent during implementation)_

## QA Results

_(This section is owned by qa-agent and can only be modified by qa-agent)_
