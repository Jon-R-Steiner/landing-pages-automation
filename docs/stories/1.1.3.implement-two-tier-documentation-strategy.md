# Story 1.1.3: Implement Two-Tier Documentation Context Strategy

## Status
Draft

## Story
**As a** Phase 0 developer,
**I want** a two-tier documentation loading strategy,
**so that** token usage is reduced by ≥30% while maintaining access to historical context when needed.

## Acceptance Criteria

1. Living documentation template (from Story 1.2) implements Active tier structure: current version + last 3 versions always loaded
2. Archive tier structure defined: full history stored separately, loaded only on keyword detection
3. Keyword detection mechanism specified for triggers: "why was this built", "history", "past errors", "previous versions"
4. Documentation in `docs/living-docs-strategy.md` explaining Active vs Archive tiers with loading logic
5. Token baseline measurement documented: measure current full-history documentation load (use Anthropic token counter or approximation: 4 chars ≈ 1 token if counter unavailable)
6. Two-tier strategy committed to Git with message: `feat: implement two-tier documentation context strategy`

## Tasks / Subtasks

- [ ] Update living documentation template for Active tier (AC: 1)
  - [ ] Modify `.bmad-core/templates/living-doc-tmpl.yaml`
  - [ ] Add Active tier structure (current + last 3 versions)
  - [ ] Define version metadata fields
  - [ ] Document Active tier loading behavior
- [ ] Define Archive tier structure (AC: 2)
  - [ ] Specify full history storage format
  - [ ] Define archive file naming convention
  - [ ] Document archive tier loading conditions
  - [ ] Add guidance for archiving older versions
- [ ] Specify keyword detection mechanism (AC: 3)
  - [ ] List keyword triggers: "why was this built", "history", "past errors", "previous versions"
  - [ ] Document detection logic
  - [ ] Specify archive loading behavior on keyword match
  - [ ] Add additional relevant keywords if needed
- [ ] Create living docs strategy document (AC: 4)
  - [ ] Create `docs/living-docs-strategy.md`
  - [ ] Explain Active tier: current + last 3 versions
  - [ ] Explain Archive tier: full history, keyword-triggered loading
  - [ ] Document loading logic and transitions
  - [ ] Provide examples of when each tier is used
- [ ] Measure token baseline (AC: 5)
  - [ ] Identify current full-history documentation size
  - [ ] Use Anthropic token counter if available
  - [ ] If unavailable, use approximation: 4 characters ≈ 1 token
  - [ ] Document baseline measurement in strategy doc
  - [ ] Calculate expected token reduction (≥30%)
- [ ] Commit two-tier strategy to Git (AC: 6)
  - [ ] Review all changes for completeness
  - [ ] Stage template updates and strategy doc with `git add`
  - [ ] Create commit with message: `feat: implement two-tier documentation context strategy`
  - [ ] Verify commit was created successfully

## Dev Notes

### Context
Fifth story in Phase 0 Epic 1. Implements token optimization strategy for living documentation. This story builds on the template from Story 1.2 to add intelligent context loading that reduces token usage while preserving access to historical information.

### Key Information
- **Template Location:** `.bmad-core/templates/living-doc-tmpl.yaml` (updated from Story 1.2)
- **Strategy Doc Location:** `docs/living-docs-strategy.md`
- **Token Reduction Goal:** ≥30% reduction in documentation token usage
- **Two Tiers:**
  1. **Active Tier:** Current version + last 3 versions (always loaded)
  2. **Archive Tier:** Full history (loaded only on keyword detection)

### Dependencies
- **Prerequisites:** Story 1.2 (requires living documentation template)
- **Blocks:** None directly, but informs Phase 1 agents on documentation patterns
- **Relates to:** Risk 5 mitigation (token usage optimization)

### Token Optimization Strategy
- Active tier keeps recent context immediately available
- Archive tier prevents token waste on rarely-needed history
- Keyword detection enables on-demand historical access
- Expected 30%+ token reduction based on typical version access patterns

### Keyword Triggers
- "why was this built" → load archive for historical rationale
- "history" → load archive for evolution timeline
- "past errors" → load archive for lessons learned
- "previous versions" → load archive for version comparison

### Important Decisions
- 3-version Active tier balances recency with token usage
- Keyword-based loading provides flexibility without constant overhead
- Token measurement uses approximation if precise counter unavailable
- Strategy documented for Phase 1 agents to follow consistently

### Testing

**Test Standards:**
- No automated tests required (documentation strategy)
- Manual validation of template structure
- Token measurement calculation

**Validation Requirements:**
- Template must include Active tier structure
- Archive tier must be defined
- Keyword triggers must be documented
- Token baseline must be measured
- Strategy document must explain both tiers clearly
- All changes must be committed to Git

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | 1.0 | Initial story creation from Epic 1 requirements | PM Agent (John) |

## Dev Agent Record

_(This section is owned by dev-agent and can only be modified by dev-agent)_

### Agent Model Used
_(This section will be populated by dev-agent during implementation)_

### Debug Log References
_(This section will be populated by dev-agent during implementation)_

### Completion Notes
_(This section will be populated by dev-agent during implementation)_

### File List
_(This section will be populated by dev-agent during implementation)_

## QA Results

_(This section is owned by qa-agent and can only be modified by qa-agent)_
